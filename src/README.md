# BrickGame Тетрис (CLI)

## Обзор
Этот репозиторий содержит реализацию первого задания серии BrickGame — классический «Тетрис» в терминале. Игровая логика оформлена как статическая библиотека, совместимая с общим API BrickGame, а интерфейс на базе ncurses отвечает за рендеринг, обработку ввода и игровой цикл. В проект также входят модульные тесты и диаграмма конечного автомата (FSM), описывающая работу движка.

## Структура
- `brick_game/tetris/`
  - `game_interface.h` — публичный API, общий для всех фронтендов.
  - `game_logic.c`, `game_logic.h` — конечный автомат, начисление очков, уровни и скорость, превью следующей фигуры, сохранение рекорда.
- `gui/cli/`
  - `gui.c` — точка входа, меню и цикл ввода на ncurses.
  - `frontend.c/.h` — отрисовка игрового поля, боковой панели, превью и настройка цветовой схемы.
- `tests/test.c` — юнит-тесты на Check, проверяющие перемещение, вращение, паузу, подсчёт очков и переходы FSM.
- `docs/fsm.dot`, `docs/fsm.png` — исходник DOT и готовая диаграмма конечного автомата.
- `high_score.dat` — начальное значение рекорда.

## Зависимости
- Компилятор C с поддержкой C11 (проверено на GCC/Clang).
- Заголовки `ncurses`.
- Фреймворк модульных тестов `check`.
- Опционально: `graphviz` (для пересборки диаграммы) и `gcovr`/lcov для отчётов покрытия.

macOS (Homebrew):
```bash
brew install ncurses check graphviz gcovr
```
Ubuntu/Debian:
```bash
sudo apt-get install libncurses5-dev check graphviz gcovr
```

## Сборка и запуск
Из каталога `src/`:
```bash
make            # сборка библиотеки и CLI-приложения
./tetris        # запуск игры (важно запускать из src/, чтобы работало сохранение рекорда)
```
Бинарник ищет `high_score.dat` в текущем каталоге.

### Установка и упаковка
```bash
make install    # установка в ~/TetrisGame (путь можно поменять через INSTALL_DIR)
make dist       # создаёт dist/tetris_project.tar.gz с исходниками, материалами и документацией
```

## Тесты и покрытие
```bash
make test         # запускает юнит-тесты на базе Check
make gcov_report  # формирует HTML-отчёт покрытия в src/gcov_report/index.html
```
`make gcov_report` пересобирает проект с флагами покрытия, заново запускает тесты и использует `gcovr` для генерации отчёта.

## Управление
- Главное меню: `Enter` — старт, `Q` — выход.
- Во время игры:
  - `←` / `→` — перемещение фигуры.
  - `Space` — поворот по часовой стрелке.
  - `↓` — мгновенный харддроп (фиксирует фигуру).
  - `P` — пауза.
  - `R` — рестарт после Game Over.
  - `Q` / `Esc` — завершение сессии.

Боковая панель показывает текущий счёт, сохранённый рекорд, уровень (растёт каждые 600 очков, максимум 10), скорость (задержка тиков), состояние паузы и превью следующего тетромино.

## Диаграмма FSM
Движок реализован как детерминированный конечный автомат с состояниями `START`, `SPAWN`, `FALLING`, `LOCK`, `PAUSE`, `GAME_OVER`. В `docs/fsm.png` (полученном из `docs/fsm.dot`) перечислены все переходы между состояниями.

## Примечания
- Подсчёт очков соответствует ТЗ: 100/300/700/1500 очков за 1–4 линии соответственно.
- Рекорд сохраняется между запусками, если игре удаётся записать `high_score.dat`.
- Стрелка вниз реализует харддроп; если проверяющая система требует мягкого падения, нужно адаптировать логику и тесты.
